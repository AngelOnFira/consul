---
layout: docs
page_title: Service Mesh - Configuration
description: >-
  Sidecar proxies configured by Consul enable unmodified applications to join
  the mesh. They transparently handle inbound and outbound service
  connections, automatically wrapping and verifying TLS connections.
---

# Consul Service Mesh Configuration

This topic covers the key configuration options exposed for the connect subsystem
that provides Consul's service mesh capabilities.

## Agent Configuration

The only required configuration to use Consul service mesh is to enable the
connect subsystem by setting [`connect.enabled`](/docs/agent/options#connect_enabled)
on Consul _server_ agents (client agents do not require this change).
All other connect subsystem configurations are optional and have reasonable defaults.

By default, the connect subsystem is disabled unless Consul is started in
[development mode](https://www.consul.io/docs/agent/options#_dev).
To enable, include the following configuration in a [server configuration file](/docs/agent/options).
In an existing cluster, this configuration change requires a Consul server restart,
which you can perform one server at a time to maintain availability.
In HCL:

```hcl
connect {
  enabled = true
}
```

This will enable the connect subsystem and configure your Consul cluster to use the
built-in service mesh certificate authority for creating and managing certificates.
You may also configure Consul to use an external
[certificate management system](/docs/connect/ca), such as
[Vault](https://vaultproject.io).

Until the connect subsystem is enabled on the server agents,
services and proxies that attempt to register with the service mesh by specifying
a [connect subsystem stanza](/docs/discovery/services#connect) will fail to
retrieve or verify any TLS certificates, causing service-to-service connections to fail.

Other optional connect subsystem configurations that you can set in the server
configuration file include:

- [certificate authority settings](/docs/agent/options#connect)
- [token replication](/docs/agent/options#acl_tokens_replication)
- [dev mode](/docs/agent/options#_dev)
- [server host name verification](/docs/agent/options#verify_server_hostname)

If you would like to use Envoy as your service mesh sidecar proxy you will need to [enable
gRPC](/docs/agent/options#grpc_port).

Additionally if you plan on using the observability features of Consul service mesh, it can
be convenient to configure your proxies and services using [configuration
entries](/docs/agent/config-entries) which you can interact with using the
CLI or API, or by creating configuration entry files. You will want to enable
[centralized service configuration](/docs/agent/options#enable_central_service_config) on
clients, which allows each service's proxy configuration to be managed centrally via API.

!> **Security note:** Enabling the connect subsystem is enough to try Consul service mesh
   but doesn't automatically ensure complete security. Please read the
   [Connect production tutorial](https://learn.hashicorp.com/tutorials/consul/service-mesh-production-checklist)
   to understand the additional steps needed for a secure deployment.

## Centralized Proxy and Service Configuration

To account for common service mesh use cases where you have many instances of the
same service, and many colocated sidecar proxies, Consul allows you to customize
the settings for all of your proxies or all the instances of a given service at
once using [Configuration Entries](/docs/agent/config-entries).

You can override centralized configurations for individual proxy instances in
their
[sidecar service definitions](/docs/connect/registration/sidecar-service),
and the default protocols for service instances in their [service
registrations](/docs/discovery/services).

## Schedulers

Consul service mesh is especially useful if you are using an orchestrator like Nomad
or Kubernetes, because these orchestrators can deploy thousands of service instances
which frequently move hosts. Sidecars for each service can be configured through
these schedulers, and in some cases they can automate Consul configuration,
sidecar deployment, and service registration.

### Nomad

Connect can be used with Nomad to provide secure service-to-service
communication between Nomad jobs and task groups. The ability to use the dynamic
port feature of Nomad makes Consul service mesh particularly easy to use. Learn about how to
configure Consul service mesh on Nomad by reading the
[integration documentation](/docs/connect/nomad)

### Kubernetes

The Consul Helm chart can automate much of Consul service mesh's configuration, and
makes it easy to automatically inject Envoy sidecars into new pods when they are
deployed. Learn about the [Helm chart](/docs/platform/k8s/helm) in general,
or if you are already familiar with it, check out its
[connect subsystem specific configurations](/docs/platform/k8s/connect).
