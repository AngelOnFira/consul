---
layout: docs
page_title: ACL Policy Examples
description: >-
  ACL policy examples to help find a policy for your use case.
---

# ACL Policy Examples

This topic includes example policy configurations for achieving specific use-cases.

## Enable service registration

<Tabs>

<Tab heading="Service Mesh">

For Consul service mesh, we recommend using a [service
identity](/consul/docs/security/acl#service-identities) to grant the permissions to register a
service rather than creating a custom policy. The service identity grants the `service:write`
permissions necessary for the service and its sidecar proxy to register into the catalog. It grants
`service:read` and `node:read` for any services so that the sidecar proxy can discover and route to
other services and nodes in the catalog.

When `service:write` permissions are granted, the `intention:read` permission is implicitly granted
in order for sidecar proxies to read and enforce intentions. Refer to [Intention Management
Permissions](/consul/docs/connect/intentions#intention-management-permissions) for details.

</Tab>

<Tab heading="Custom Policy">

The following policy allows a service named `web` to register into the catalog.

```hcl
service "web" {
  policy = "write"
}
```

</Tab>

<Tab heading="Custom Policy (Enterprise)">

The following policy allows a service named `web` to register into the catalog
in namespace `ns1` and partition `ptn1`.

```hcl
partition "ptn1" {
  namespace "ns1" {
    service "web" {
      policy = "write"
    }
  }
}
```

</Tab>

</Tabs>

## Enable client agent registration

To register a client agent, `node:write` is required for the node name of the gaent and broad
`service:read` is needed for the agent to discover other services.

<Tabs>

<Tab heading="Client agent">

To register a Consul client agents, we recommend using a [node
identity](/consul/docs/security/acl#node-identities) rather than creating a custom policy. The ACL
token with the node identity can be configured as the [`agent`
token](/consul/docs/agent/config/config-files#acl_tokens_agent) used for the agent's internal
operations.
</Tab>

<Tab heading="Custom Policy">

The following policy allows a node name `client1` to register into the catalog.

```hcl
node "client1" {
  policy = "write"
}
service_prefix "" {
  policy = "read"
}
```

</Tab>

<Tab heading="Custom Policy (Enterprise)">

The following policy allows a node name `client1` to register into the catalog
in the `ptn1` partition.

```hcl
partition "ptn1"
  node "client1" {
    policy = "write"
  }
  namespace_prefix "" {
    service_prefix "" {
      policy = "read"
    }
  }
}
```

</Tab>

</Tabs>

## Enable view access to the Consul UI

The following policies grant read-only access when logged in to the Consul UI.

<Tabs>

<Tab heading="Catalog">

The following policy grants read-only access to view nodes and services in the catalog.

<Tabs>

<Tab heading="OSS">

```hcl
service_prefix "" {
  policy = "read"
}
node_prefix "" {
  policy = "read"
}
```

</Tab>

<Tab heading="Enterprise">

```hcl
partition_prefix "" {
  namespace_prefix "" {
    service_prefix "" {
      policy = "read"
    }
    node_prefix "" {
      policy = "read"
    }
  }
}
```

</Tab>

</Tabs>

</Tab>

<Tab heading="Catalog and ACL resources">

The following policy grants access to view the catalog and all ACL resources.

<Tabs>

<Tab heading="OSS">

```hcl
acl = "read"
service_prefix "" {
  policy = "read"
}
node_prefix "" {
  policy = "read"
}
```

</Tab>

<Tab heading="Enterprise">

```hcl
partition_prefix "" {
  namespace_prefix "" {
    acl = "read"
    service_prefix "" {
      policy = "read"
    }
    node_prefix "" {
      policy = "read"
    }
  }
}
```

</Tab>

</Tabs>

</Tab>

</Tabs>

## Enable mesh gateway registration

The following policy allows a mesh gateway to register as a service named `mesh-gateway`.

The `agent:read` permission allows the `consul connect envoy` CLI command to automatically discover
gRPC settings from the Consul agent. If this command is not used to start the gateway or if the
Consul agent uses the default gRPC settings, then the `agent:read` permission may be ommitted.

<Tabs>

<Tab heading="OSS">

<Tabs>

<Tab heading="Standard">

```hcl
mesh = "write"
service "mesh-gateway" {
   policy = "write"
}
service_prefix "" {
   policy = "read"
}
node_prefix "" {
   policy = "read"
}
agent_prefix "" {
   policy = "read"
}
```

</Tab>

<Tab heading="Peering">

```hcl
mesh = "write"
peering = "read"
service "mesh-gateway" {
   policy = "write"
}
service_prefix "" {
   policy = "read"
}
node_prefix "" {
   policy = "read"
}
agent_prefix "" {
   policy = "read"
}
```

</Tab>

</Tabs>

</Tab>

<Tab heading="Enterprise">

With Consul Enterprise, mesh gateways must register into the `default` namespace.

To register a mesh gateway in a non-default partition, create the ACL token for the mesh gateway
in the non-default partition with the following policy rules.

<Tabs>

<Tab heading="Standard">

```hcl
mesh = "write"
namespace "default" {
  service "mesh-gateway" {
     policy = "write"
  }
  agent_prefix "" {
     policy = "read"
  }
}
namespace_prefix "" {
  node_prefix "" {
  	policy = "read"
  }
  service_prefix "" {
     policy = "read"
  }
}
```

</Tab>

<Tab heading="Peering (Default Partition)">

```hcl
mesh = "write"
peering = "read"
partition_prefix "" {
  peering = "read"
}
namespace "default" {
  service "mesh-gateway" {
     policy = "write"
  }
  agent_prefix "" {
     policy = "read"
  }
}
namespace_prefix "" {
  node_prefix "" {
  	policy = "read"
  }
  service_prefix "" {
     policy = "read"
  }
}
```

</Tab>

<Tab heading="Peering (Non-Default Partition)">

```hcl
mesh = "write"
peering = "read"
namespace "default" {
  service "mesh-gateway" {
     policy = "write"
  }
  agent_prefix "" {
     policy = "read"
  }
}
namespace_prefix "" {
  node_prefix "" {
  	policy = "read"
  }
  service_prefix "" {
     policy = "read"
  }
}
```

</Tab>

</Tabs>

</Tab>

</Tabs>


# Enable ingress gateway registration

The following policy enables an ingress gateway to register as a service named `ingress-gateway`.

The `agent:read` permission allows the `consul connect envoy` CLI command to automatically discover
gRPC settings from the Consul agent. If this command is not used to start the gateway or if the
Consul agent uses the default gRPC settings, then the `agent:read` permission may be ommitted.


<Tabs>

<Tab heading="OSS">

```hcl
service "ingress-gateway" {
  policy = "write"
}
node_prefix "" {
  policy = "read"
}
service_prefix "" {
  policy = "read"
}
agent_prefix "" {
  policy = "read"
}
```

</Tab>

<Tab heading="Enterprise">

```hcl
partition "default" {
  namespace "default" {
    service "ingress-gateway" {
      policy = "write"
    }
    node_prefix "" {
      policy = "read"
    }
    service_prefix "" {
      policy = "read"
    }
    agent_prefix "" {
      policy = "read"
    }
  }
}
```

</Tab>

<Tab heading="Enterprise (Non-default Partition and Namespace)">

```hcl
partition "ptn1" {
  namespace "ns1" {
    service "ingress-gateway" {
      policy = "write"
    }
    node_prefix "" {
      policy = "read"
    }
    service_prefix "" {
      policy = "read"
    }
    agent_prefix "" {
      policy = "read"
    }
  }
}
```

</Tab>

</Tabs>

## Enable terminating gateway registration

The following policy allows a terminating gateway to register as a service named `terminating-gateway`
and grants `node:read` and `service:read` for any services.

The terminating gateway token needs `service:write` permission for each service that it forwards
traffic for. The following policy examples assume the terminating gateway only needs to forward
traffic for two services named `external-service-1` and `external-service-2`. However, in order to
manage `service:write` permissions for large number of services, we recommend creating a Consul ACL
role with a list of [service identities](/consul/docs/security/acl#service-identities) attached.
The role can be attached to ACL token used by the terminating gateway and then the role can the
updated in-place to include new services without needing to generate a new ACL token.

The `agent:read` permission allows the `consul connect envoy` CLI command to automatically discover
gRPC settings from the Consul agent. If this command is not used to start the gateway or if the
Consul agent uses the default gRPC settings, then the `agent:read` permission may be ommitted.

To learn how to configure terminating gateways, refer to the [Terminating
Gateways](/consul/docs/connect/gateways/terminating-gateway#terminating-gateway-configuration)
documentation and the [Understand Terminating
Gateways](/consul/tutorials/developer-mesh/service-mesh-terminating-gateways) tutorial.

<Tabs>

<Tab heading="OSS">

<Tabs>

<Tab heading="Standard">

```hcl
service "terminating-gateway" {
   policy = "write"
}
node_prefix "" {
  policy = "read"
}
agent_prefix "" {
  policy = "read"
}

# Services the terminating gateway forwards traffic for
service "external-service-1" {
  policy = "write"
}
service "external-service-2" {
  policy = "write"
}
```

</Tab>

</Tabs>

</Tab>

<Tab heading="Enterprise">

<Tabs>

<Tab heading="Default Partition and Namespace">

The following policy allows a terminating gateway in the default partition
and default namespace to forward traffic for the following two services:

* Service `external-service-1` in the `default` namespace
* Service `external-service-2` in the `ns1` namespace

```hcl
partition "default" {
  namespace "default" {
    service "terminating-gateway" {
       policy = "write"
    }
    node_prefix "" {
      policy = "read"
    }
    agent_prefix "" {
      policy = "read"
    }
  }

  # Services the terminating gateway forwards traffic for
  namespace "default" {
    service "external-service-1" {
      policy = "write"
    }
  }
  namespace "ns1" {
    service "external-service-2" {
      policy = "write"
    }
  }
}
```

</Tab>

<Tab heading="Non-default Partition and Namespace">

The following policy allows a terminating gateway in the `ptn1` partition
and `ns1` namespace to forward traffic for the following two services:

* Service `external-service-1` in the `default` namespace
* Service `external-service-2` in the `ns1` namespace

-> **Note**: The following policy contains cross-namespace permissions. ACL Policies which
grant cross-namespace permissions must be created in the `default` namespace.

```hcl
partition "ptn1" {
  namespace "ns1" {
    service "terminating-gateway" {
       policy = "write"
    }
    node_prefix "" {
      policy = "read"
    }
    agent_prefix "" {
      policy = "read"
    }
  }

  # Services the terminating gateway forwards traffic for
  namespace "default" {
    service "external-service-1" {
      policy = "write"
    }
  }
  namespace "ns1" {
    service "external-service-2" {
      policy = "write"
    }
  }
}
```

</Tab>

</Tabs>

</Tab>

</Tabs>


## Enable DNS

The following policies contain permissions suitable for configuring DNS permissions for a Consul
agent. Refer to [DNS with ACLs](/consul/docs/discovery/dns#dns-with-acls) for details on configuring
the token used to authorize DNS.

<Tabs>

<Tab heading="OSS">

The following policy allows node, service, and prepared query
lookups over DNS.

```hcl
node_prefix "" {
  policy = "read"
}
service_prefix "" {
  policy = "read"
}
query_prefix "" {
  policy = "read"
}
```

</Tab>

<Tab heading="Enterprise">

The following policy allows node, service, and prepared query
lookups over DNS in any namespace and any partition.

```hcl
partition_prefix "" {
  namespace_prefix "" {
    node_prefix "" {
      policy = "read"
    }
    service_prefix "" {
      policy = "read"
    }
    query_prefix "" {
      policy = "read"
    }
  }
}
```

</Tab>

</Tabs>

## Enable ACL replication

The following policies allow ACL replication between WAN-federated datacenters. The policy should be
attached to the token that is configured as the replication token.

A replication token must be configured on each server in a non-primary datacenter by setting the
`acl.tokens.replication` config field or by using the CLI command `consul acl set-agent-token
replication <secret-id>`. Additionally, `acl.enable_token_replication = true` must be set on each
server in a non-primary datacenter. To learn about configuring ACL replication, refer to the [ACL
Replication for Multiple
Datacenters](/consul/tutorials/security-operations/access-control-replication-multiple-datacenters)
tutorial.

-> **Note**: ACL replication is only supported for WAN-federated datacenters. When using cluster
peering to connect Consul datacenters, ACL replication is not required. To learn more about cluster
peering, refer to [Differences between WAN federation and cluster
peering](/consul/docs/connect/cluster-peering#differences-between-wan-federation-and-cluster-peering).

<Tabs>

<Tab heading="OSS">

```hcl
acl = "write"
operator = "write"
service_prefix "" {
  policy = "read"
  intentions = "read"
}
```

</Tab>

<Tab heading="Enterprise">

With Consul Enterprise, the replication token only needs permissions for the `default` partition.
This is because ACL replication is only supported between two federated clusters, and non-primary
datacenters do not allow non-default partitions with federation.

```hcl
operator = "write"
service_prefix "" {
  policy = "read"
  intentions = "read"
}
namespace_prefix "" {
  acl = "write"
  service_prefix "" {
    policy = "read"
    intentions = "read"
  }
}
```

</Tab>

</Tabs>

## Enable management of intentions

<Tabs>

<Tab heading="All Intentions">

The following polices enable setting intentions for any service.

<Tabs>

<Tab heading="OSS">

```hcl
service_prefix "" {
  policy = "read"
  intention = "write"
}
```

</Tab>

<Tab heading="Enterprise">

```hcl
partition_prefix "" {
  namespace_prefix "" {
    service_prefix "" {
      policy = "read"
      intention = "write"
    }
  }
}
```

</Tab>

</Tabs>

</Tab>

<Tab heading="Single Service">

<Tabs>

<Tab heading="OSS">

The following policy grants a service owner permission to control intentions
for incoming connections and requests to the `example-service` service.

```hcl
service "example-service" {
  policy = "write"
  intention = "write"
}
```

</Tab>

<Tab heading="Enterprise">

The following policy grants a service owner permission to control intentions
for incoming connections and requests to the `example-service` service
in the `prod` partition in the `example-team` namespace.

```hcl
partition "prod" {
  namespace "example-team" {
    service "example-service" {
      policy = "write"
      intention = "write"
    }
  }
}
```

</Tab>

</Tabs>

</Tab>


<Tab heading="View Intentions">

The following policies allow viewing all intentions.

<Tabs>

<Tab heading="OSS">

```hcl
service "" {
  policy = "read"
  intention = "read"
}
```

</Tab>

<Tab heading="Enterprise">

```hcl
partition_prefix "" {
  namespace_prefix "" {
    service "" {
      policy = "read"
      intention = "read"
    }
  }
}
```

</Tab>

</Tabs>

</Tab>

</Tabs>


## Enable the Snapshot Agent to Run on a Specific Node

The `consul snapshot agent` command starts a process that takes snapshots of the state of the Consul servers and either saves them locally or pushes them to a remote storage service. Refer to [Consul Snapshot Agent](/consul/commands/snapshot/agent) for additional information.

In the following example, the ACL policy enables the snapshot agent to run on a node named `server-1234`.

```hcl
# Required to read and snapshot ACL data
acl = "write"
# Allow the snapshot agent to create the key consul-snapshot/lock which will
# serve as a leader election lock when multiple snapshot agents are running in
# an environment
key "consul-snapshot/lock" {
  policy = "write"
}
# Allow the snapshot agent to create sessions on the specified node
session "server-1234" {
  policy = "write"
}
# Allow the snapshot agent to register itself into the catalog
service "consul-snapshot" {
  policy = "write"
}
```

## Enable Vault to Access the Consul Storage Backend

If you are using [Vault](/vault/docs) to manage secrets in your infrastructure, you can configure Vault to use Consul's key/value (KV) store as backend storage to persist Vault's data. Refer to the [Consul KV documentation](/consul/docs/dynamic-app-config/kv) and the [Vault storage documentation](/vault/docs/configuration/storage) for additional information.

In the following example, the ACL policy enables Vault to register as a service
and provides access to the `vault/` path in Consul's KV store.

```hcl
# Provide KV visibility to all agents.
agent_prefix "" {
  policy = "read"
}
# Enable resources prefixed with 'vault/' to write to the KV
key_prefix "vault/" {
  policy = "write"
}
# Enable the vault service to write to the KV
service "vault" {
  policy = "write"
}
# Enable the agent to initialize a new session.
session_prefix "" {
  policy = "write"
}
```

## Enable Consul External Service Monitor (ESM)

Consul ESM can monitor third party or external services in contexts where it is not possible to run
a Consul agent. To learn more about Consul ESM, refer to the [Register External Services with Consul
Service Discovery](/consul/tutorials/developer-discovery/service-registration-external-services)
tutorial.

<Tabs>

<Tab heading="OSS">

The following policy allows Consul ESM to monitor two nodes named `node-one` and `node-two`. It
allows Consul ESM to register as the `consul-esm` service into the catalog, to scan for nodes to
monitor, to store state in Consul's key/value store, and acquire a leader lock.

```hcl
# Nodes Consul ESM monitors.
node "node-one" {
  policy = "write"
}
node "node-two" {
  policy = "write"
}

# Other permissions for Consul ESM to operate.
agent "example-agent" {
  policy = "read"
}
key_prefix "consul-esm/" {
  policy = "write"
}
node_prefix "" {
  policy = "read"
}
service "consul-esm" {
  policy = "write"
}
session "example-agent" {
   policy = "write"
}
```

</Tab>

<Tab heading="Enterprise">

With Consul Enterprise, Consul ESM requires `acl:read` permission in each namespace where it looks
for external nodes and health checks to monitor.

The following policy allows Consul ESM to update status of two monitored nodes named `node-one` and
`node-two`. It allows Consul ESM to register as the `consul-esm` service, to manage state in the
`default` namespace, and to scan the `default` and `ns1` namespaces for nodes to monitor.

Because the following policy grants cross-namespace permissions, the policy must be created in the
`default` namespace.

-> **Note**: Consul ESM does not currently support non-default partitions.

```hcl
partition "default" {
  # Nodes Consul ESM is allowed to monitor.
  node "node-one" {
    policy = "write"
  }
  node "node-two" {
    policy = "write"
  }

  # Namespaces Consul ESM is allowed to scan.
  namespace "default" {
    acl = "read"
  }
  namespace "ns1" {
    acl = "read"
  }

  # Other permissions for Consul ESM to operate.
  agent "example-agent" {
    policy = "read"
  }
  key_prefix "consul-esm/" {
    policy = "write"
  }
  node_prefix "" {
    policy = "read"
  }
  service "consul-esm" {
    policy = "write"
  }
  session "example-agent" {
    policy = "write"
  }
}
```

</Tab>

</Tabs>
